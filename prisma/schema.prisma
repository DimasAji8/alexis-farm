generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid()) @map("id_mst_users")
  username  String   @unique
  name      String
  password  String
  role      String   @default("staff")
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([username])
  @@map("mst_users")
}

model Kandang {
  id               String           @id @default(cuid()) @map("id_mst_kandang")
  kode             String           @unique
  nama             String
  lokasi           String?
  jumlahAyam       Int              @default(0)
  status           String           @default("aktif")
  keterangan       String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  ayamMasukRecords     AyamMasuk[]
  kematianRecords      KematianRecord[]
  pemakaianPakanHeader PemakaianPakanHeader[]
  produksiTelur        ProduksiTelur[]
  stockTelur           StockTelur[]
  penjualanTelur       PenjualanTelur[]

  @@index([kode])
  @@index([status])
  @@map("mst_kandang")
}



model JenisPakan {
  id             String                   @id @default(cuid()) @map("id_mst_jenis_pakan")
  kode           String                   @unique
  nama           String
  satuan         String                   @default("KG")
  keterangan     String?
  isActive       Boolean                  @default(true)
  createdBy      String?                  @map("created_by")
  updatedBy      String?                  @map("updated_by")
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt
  pembelianPakan PembelianPakan[]
  pemakaianPakan PemakaianPakanHeader[]

  @@index([kode])
  @@map("mst_jenis_pakan")
}

model AyamMasuk {
  id           String   @id @default(cuid()) @map("id_trx_ayam_masuk")
  kandangId    String   @map("id_mst_kandang")
  tanggal      DateTime
  jumlahAyam   Int
  createdBy    String?  @map("created_by")
  updatedBy    String?  @map("updated_by")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  kandang      Kandang  @relation(fields: [kandangId], references: [id], onDelete: Cascade)

  @@index([kandangId])
  @@index([tanggal])
  @@map("trx_ayam_masuk")
}

model KematianRecord {
  id         String   @id @default(cuid()) @map("id_trx_kematian_ayam")
  kandangId  String   @map("id_mst_kandang")
  tanggal    DateTime
  jumlahMati Int
  keterangan String?
  createdBy  String?  @map("created_by")
  updatedBy  String?  @map("updated_by")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  kandang    Kandang  @relation(fields: [kandangId], references: [id], onDelete: Cascade)

  @@index([kandangId])
  @@index([tanggal])
  @@map("trx_kematian_ayam")
}

model PembelianPakan {
  id             String           @id @default(cuid()) @map("id_trx_pembelian_pakan")
  jenisPakanId   String           @map("id_mst_jenis_pakan")
  tanggalBeli    DateTime
  jumlahKg       Float
  hargaPerKg     Float
  totalHarga     Float
  sisaStokKg     Float
  keterangan     String?
  createdBy      String?          @map("created_by")
  updatedBy      String?          @map("updated_by")
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  jenisPakan     JenisPakan       @relation(fields: [jenisPakanId], references: [id])
  details        PemakaianPakanDetail[]

  @@index([jenisPakanId])
  @@index([tanggalBeli])
  @@map("trx_pembelian_pakan")
}

model PemakaianPakanHeader {
  id           String                   @id @default(cuid()) @map("id_trx_pemakaian_pakan_header")
  kandangId    String                   @map("id_mst_kandang")
  jenisPakanId String                   @map("id_mst_jenis_pakan")
  tanggalPakai DateTime
  jumlahKg     Float
  totalBiaya   Float
  keterangan   String?
  createdBy    String?                  @map("created_by")
  updatedBy    String?                  @map("updated_by")
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt
  kandang      Kandang                  @relation(fields: [kandangId], references: [id], onDelete: Cascade)
  jenisPakan   JenisPakan               @relation(fields: [jenisPakanId], references: [id])
  details      PemakaianPakanDetail[]

  @@index([kandangId])
  @@index([jenisPakanId])
  @@index([tanggalPakai])
  @@map("trx_pemakaian_pakan_header")
}

model PemakaianPakanDetail {
  id               String                @id @default(cuid()) @map("id_trx_pemakaian_pakan_detail")
  headerId         String                @map("id_trx_pemakaian_pakan_header")
  pembelianPakanId String                @map("id_trx_pembelian_pakan")
  jumlahKg         Float
  hargaPerKg       Float
  totalBiaya       Float
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  header           PemakaianPakanHeader  @relation(fields: [headerId], references: [id], onDelete: Cascade)
  pembelianPakan   PembelianPakan        @relation(fields: [pembelianPakanId], references: [id])

  @@index([headerId])
  @@index([pembelianPakanId])
  @@map("trx_pemakaian_pakan_detail")
}

model ProduksiTelur {
  id                    String   @id @default(cuid()) @map("id_trx_produksi_telur")
  kandangId             String   @map("id_mst_kandang")
  tanggal               DateTime
  jumlahBagusButir      Int      @default(0)
  jumlahTidakBagusButir Int      @default(0)
  totalButir            Int
  totalKg               Float
  keterangan            String?
  createdBy             String?  @map("created_by")
  updatedBy             String?  @map("updated_by")
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  kandang               Kandang  @relation(fields: [kandangId], references: [id], onDelete: Cascade)

  @@unique([kandangId, tanggal])
  @@index([kandangId])
  @@index([tanggal])
  @@map("trx_produksi_telur")
}

model StockTelur {
  id         String   @id @default(cuid()) @map("id_trx_stock_telur")
  kandangId  String   @map("id_mst_kandang")
  tanggal    DateTime
  stockButir Int
  stockKg    Float
  keterangan String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  kandang    Kandang  @relation(fields: [kandangId], references: [id], onDelete: Cascade)

  @@unique([kandangId, tanggal])
  @@index([tanggal])
  @@index([kandangId])
  @@map("trx_stock_telur")
}

model PenjualanTelur {
  id             String   @id @default(cuid()) @map("id_trx_penjualan_telur")
  kandangId      String   @map("id_mst_kandang")
  nomorTransaksi String   @unique
  tanggal        DateTime
  pembeli        String
  jumlahButir    Int
  beratKg        Float
  hargaPerKg     Float
  totalHarga     Float
  saldoAwal      Float    @default(0)
  uangMasuk      Float    @default(0)
  uangKeluar     Float    @default(0)
  saldoAkhir     Float    @default(0)
  metodeBayar    String?
  keterangan     String?
  createdBy      String?  @map("created_by")
  updatedBy      String?  @map("updated_by")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  kandang        Kandang  @relation(fields: [kandangId], references: [id], onDelete: Cascade)

  @@index([tanggal])
  @@index([pembeli])
  @@index([kandangId])
  @@map("trx_penjualan_telur")
}

model TransaksiKeuangan {
  id            String   @id @default(cuid()) @map("id_trx_transaksi_keuangan")
  tanggal       DateTime
  jenis         String
  kategori      String
  jumlah        Float
  keterangan    String?
  referensiId   String?
  referensiType String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([tanggal])
  @@index([jenis])
  @@index([kategori])
  @@map("trx_transaksi_keuangan")
}

model PengeluaranOperasional {
  id         String   @id @default(cuid()) @map("id_trx_pengeluaran_operasional")
  tanggal    DateTime
  kategori   String
  jumlah     Float
  keterangan String
  bukti      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([tanggal])
  @@index([kategori])
  @@map("trx_pengeluaran_operasional")
}

model LaporanBulanan {
  id                          String   @id @default(cuid()) @map("id_trx_laporan_bulanan")
  bulan                       Int
  tahun                       Int
  totalPemasukanTelur         Float    @default(0)
  totalPemasukanLain          Float    @default(0)
  totalPengeluaranPakan       Float    @default(0)
  totalPengeluaranOperasional Float    @default(0)
  totalPengeluaranLain        Float    @default(0)
  totalPemasukan              Float    @default(0)
  totalPengeluaran            Float    @default(0)
  labaRugi                    Float    @default(0)
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt

  @@unique([bulan, tahun])
  @@index([tahun, bulan])
  @@map("trx_laporan_bulanan")
}
